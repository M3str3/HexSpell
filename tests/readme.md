# HexSpell - Testing System

## Overview

The **HexSpell** project is a Rust library designed to parse various binary formats, including PE, ELF, and Mach-O. The testing framework for this project is crucial to ensure the accuracy and reliability of the parsing functions. This document will guide you through the structure of the testing system, how to add new tests, and how to manually generate and validate the necessary TOML configuration files.

## Directory Structure

Here is the structure of the `tests` directory:

```
├───out
├───samples
├───scripts
└───source
```



### Key Directories and Files

- **scripts/generator.py**: Generates the `tests.toml` file used by the tests (see section below).

- **pe.rs, elf.rs, macho.rs**: These files contain the Rust test cases for parsing PE, ELF, and Mach-O binaries, respectively.

- **tests.toml**: A TOML file that defines the expected structure of the binaries. This file is auto-generated by `generator.py` and is crucial for verifying that the parser works correctly.

- **samples/**: This directory contains the binary files used for testing. Each binary corresponds to a format (PE, ELF, Mach-O) and is referenced in the tests.

- **out/**: This directory is used to store modified binaries after running certain tests, such as shellcode injection.

- **source/**: Contains the source code (C/C++) of the binaries found in the `samples/` directory.

## Generating the `tests.toml` File

The `tests.toml` file defines the expected outcomes for each binary parsed by the library. From the `tests` directory, generate a preliminary file with:

```sh
python3 scripts/generator.py -i samples/ -o tests.toml
```

After running the script, manually review `tests.toml` to verify that each value matches the expected structure of its binary.
## Script Options
* -i, --input: Specifies the directory containing the binaries to analyze. The default is samples/.
* -o, --output: Specifies the output file for the generated TOML. The default is tests.toml.
* -d, --debug: Enables verbose debug output.

## Running Tests
To run the tests, simply use the following command in your Rust project's root directory:
```sh
cargo test
```

This command will execute all the tests defined in `pe.rs`, `elf.rs`, and `macho.rs`, comparing the parsed values against those defined in `tests.toml`.

## Adding New Tests
1. Add New Binaries: Place the new binary files in the samples/ directory.

2. Generate or Update tests.toml: Run generator.py to generate the corresponding entries in tests.toml.

3. Write Test Cases: Modify or add test cases in `pe.rs`, `elf.rs`, or `macho.rs` to include the new binaries. Ensure the test cases reference the correct keys in `tests.toml`.

4. Run Tests: Execute cargo test to ensure everything works as expected.

## Contributing
When contributing to the testing framework, ensure that:

- New tests are clearly documented.
- Any modifications to the generator.py script or tests.toml format are well-explained.
- All tests pass before submitting a pull request.

For any questions or clarifications, feel free to open an issue or reach out to the project maintainers.
